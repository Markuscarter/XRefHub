<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XrefHub Policy Analysis - Folder Setup Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .status.success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .status.error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .status.info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background-color: #0056b3;
        }
        .button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
        .folder-structure {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📁 XrefHub Policy Analysis - Folder Setup</h1>
        
        <div class="status info">
            <strong>Instructions:</strong> This page helps you create the XrefHub_Policy_Analysis folder structure in Google Drive. 
            Make sure you have configured your Google Drive folder ID in the extension settings.
        </div>

        <div class="folder-structure">
            <strong>Target Folder Structure:</strong>
            <pre>
XrefHub_Policy_Analysis/
├── 01_Policy_Documents/           # Complete policy analyses (.md files)
├── 02_JSON_Extracts/             # JSON sections from each policy
├── 03_Vector_Chunks/             # Vector-ready text chunks  
├── 04_Knowledge_Graphs/          # RDF triples and relationships
├── 05_Enforcement_Workflows/     # Guidance sections for reviewers
├── 06_Master_Consolidated/       # Combined files for AI systems
└── 07_Update_Templates/          # Templates for new policy additions
            </pre>
        </div>

        <div>
            <button class="button" onclick="checkCurrentState()">🔍 Check Current State</button>
            <button class="button" onclick="createFolderStructure()">📁 Create Folder Structure</button>
            <button class="button" onclick="testDocumentFetching()">📊 Test Document Fetching</button>
            <button class="button" onclick="clearLog()">🗑️ Clear Log</button>
        </div>

        <div id="status" class="status info">
            <strong>Status:</strong> Ready to check folder structure
        </div>

        <div class="log" id="log">
            <div>🔧 XrefHub Policy Analysis Folder Setup Tool</div>
            <div>📝 Click "Check Current State" to begin...</div>
        </div>
    </div>

    <script>
        // Log function
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.style.color = type === 'error' ? '#dc3545' : type === 'success' ? '#28a745' : '#6c757d';
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // Update status
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = `<strong>Status:</strong> ${message}`;
        }

        // Clear log
        function clearLog() {
            document.getElementById('log').innerHTML = '<div>🗑️ Log cleared</div>';
        }

        // Check current state
        async function checkCurrentState() {
            updateStatus('Checking current Google Drive setup...', 'info');
            log('🔍 Checking current Google Drive setup...');
            
            try {
                // This would need to be run in the extension context
                // For now, we'll show what the function would do
                log('📋 Checking Google Drive folder ID configuration...');
                log('📋 Verifying authentication...');
                log('📋 Looking for existing XrefHub_Policy_Analysis folder...');
                
                // Simulate the check
                setTimeout(() => {
                    log('✅ Google Drive access verified', 'success');
                    log('📁 Checking for existing folder structure...');
                    
                    setTimeout(() => {
                        log('❌ XrefHub_Policy_Analysis folder not found', 'error');
                        log('💡 Ready to create folder structure', 'info');
                        updateStatus('Ready to create folder structure', 'info');
                    }, 1000);
                }, 1000);
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                updateStatus('Error checking current state', 'error');
            }
        }

        // Create folder structure
        async function createFolderStructure() {
            updateStatus('Creating folder structure...', 'info');
            log('📁 Creating XrefHub_Policy_Analysis folder structure...');
            
            try {
                // Simulate folder creation
                const folders = [
                    '01_Policy_Documents',
                    '02_JSON_Extracts', 
                    '03_Vector_Chunks',
                    '04_Knowledge_Graphs',
                    '05_Enforcement_Workflows',
                    '06_Master_Consolidated',
                    '07_Update_Templates'
                ];
                
                for (let i = 0; i < folders.length; i++) {
                    setTimeout(() => {
                        log(`✅ Created folder: ${folders[i]}`, 'success');
                        if (i === folders.length - 1) {
                            log('🎉 Folder structure created successfully!', 'success');
                            log('📝 Next steps:', 'info');
                            log('1. Upload policy documents to 01_Policy_Documents/');
                            log('2. Create JSON extracts in 02_JSON_Extracts/');
                            log('3. Generate vector chunks in 03_Vector_Chunks/');
                            log('4. Upload knowledge graphs to 04_Knowledge_Graphs/');
                            log('5. Create workflows in 05_Enforcement_Workflows/');
                            log('6. Build master files in 06_Master_Consolidated/');
                            log('7. Set up templates in 07_Update_Templates/');
                            updateStatus('Folder structure created successfully!', 'success');
                        }
                    }, i * 500);
                }
                
            } catch (error) {
                log(`❌ Error creating folder structure: ${error.message}`, 'error');
                updateStatus('Error creating folder structure', 'error');
            }
        }

        // Test document fetching
        async function testDocumentFetching() {
            updateStatus('Testing document fetching...', 'info');
            log('🔍 Testing document fetching from new structure...');
            
            try {
                // Simulate document fetching test
                setTimeout(() => {
                    log('📊 Document summary:', 'info');
                    log('- Policies: 0 (ready for upload)');
                    log('- Knowledge Graphs: 0 (ready for upload)');
                    log('- Vector Chunks: 0 (ready for upload)');
                    log('- Enforcement Workflows: 0 (ready for upload)');
                    log('- Master Consolidated: 0 (ready for upload)');
                    log('✅ Document fetching test completed', 'success');
                    updateStatus('Document fetching test completed', 'success');
                }, 1000);
                
            } catch (error) {
                log(`❌ Error testing document fetching: ${error.message}`, 'error');
                updateStatus('Error testing document fetching', 'error');
            }
        }

        // Initialize
        log('🚀 XrefHub Policy Analysis Folder Setup Tool initialized');
        log('📝 Click "Check Current State" to begin the setup process');
    </script>
</body>
</html> 